import{u as b,j as e}from"./index-BJ2RQODn.js";import{e as y,r as n}from"./vendor-Bj8RrwSB.js";import{a as p}from"./utils-D7-Zsnno.js";import{g as N}from"./pdfGenerator-Cz8x8bN-.js";import{a1 as u,a9 as k}from"./ui-27QXhGAK.js";const E=()=>{const{workspaceId:o}=y(),{token:v}=b(),[s,a]=n.useState("loading"),[f,i]=n.useState("");return n.useEffect(()=>{o&&(async()=>{var l,c,d,m;try{const r=localStorage.getItem("token");if(!r){a("error"),i("Authentication required. Please log in.");return}const[g,j]=await Promise.all([p.get("http://localhost:5000/api/billing/status",{headers:{Authorization:`Bearer ${r}`}}),p.get(`http://localhost:5000/api/workspaces/${o}`,{headers:{Authorization:`Bearer ${r}`}})]),x=g.data;if(!x||x.plan!=="pro"){a("pro_locked");return}const t=j.data;typeof t.state_json=="string"&&(t.state_json=JSON.parse(t.state_json)),a("generating");const w={name:t.name,description:t.description||((l=t.state_json)==null?void 0:l.description),infraSpec:(c=t.state_json)==null?void 0:c.infraSpec,costEstimation:(d=t.state_json)==null?void 0:d.costEstimation,state_json:t.state_json},h=(m=t.state_json)==null?void 0:m.diagramImage;await N(w,h),a("success"),setTimeout(()=>{},4e3)}catch(r){console.error("Download workflow failed:",r),a("error"),i("Failed to generate report. Project might not exist.")}})()},[o]),e.jsx("div",{className:"min-h-screen bg-[#000] flex flex-col items-center justify-center p-6 text-center text-white",children:e.jsxs("div",{className:"max-w-md w-full bg-white/5 border border-white/10 rounded-3xl p-10 backdrop-blur-xl",children:[(s==="loading"||s==="generating")&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"mx-auto w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:s==="loading"?"Checking Permissions...":"Generating PDF Report..."}),e.jsx("p",{className:"text-gray-400",children:"Please wait while we prepare your professional documentation."})]})]}),s==="pro_locked"&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-yellow-500/20 rounded-full flex items-center justify-center",children:e.jsx(u,{className:"w-10 h-10 text-yellow-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Pro Plan Required"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Professional PDF reports with cost breakdown and architecture diagrams are a Pro feature."}),e.jsx("button",{onClick:()=>window.location.href="/settings?tab=billing",className:"w-full py-3 px-4 bg-primary hover:bg-primary/90 text-white rounded-xl font-bold transition-all transform hover:scale-105",children:"Upgrade to Pro"}),e.jsx("button",{onClick:()=>window.history.back(),className:"mt-4 text-sm text-gray-500 hover:text-gray-300",children:"Go Back"})]})]}),s==="success"&&e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center",children:e.jsx(k,{className:"w-10 h-10 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Report Downloaded!"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Your download has started automatically."}),e.jsx("div",{className:"text-sm text-gray-500",children:"You can close this window now."})]})]}),s==="error"&&e.jsxs("div",{className:"space-y-6 animate-shake",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center",children:e.jsx(u,{className:"w-10 h-10 text-red-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Download Failed"}),e.jsx("p",{className:"text-red-400",children:f})]}),e.jsx("button",{onClick:()=>window.location.href="/",className:"px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl font-semibold transition-colors",children:"Return Home"})]})]})})};export{E as default};
