import{u as M,j as e}from"./index-BJ2RQODn.js";import{u as G,r as d}from"./vendor-Bj8RrwSB.js";import{a as g,B as m}from"./utils-D7-Zsnno.js";import{g as J}from"./pdfGenerator-Cz8x8bN-.js";import{g as V,H as q,S as C,h as U,P as Y,i as P,j as K,k as D,l as Q,m as X,b as L,n as Z}from"./ui-27QXhGAK.js";const oe=()=>{const{user:b,logout:F}=M(),x=G(),[p,f]=d.useState([]),[$,j]=d.useState(!0),[y,v]=d.useState(null),[u,I]=d.useState(""),[h,R]=d.useState("all"),[N,w]=d.useState(null),[E,W]=d.useState(!1);d.useEffect(()=>{_(),A()},[]);const A=async()=>{try{const t=localStorage.getItem("token"),s=await g.get("http://localhost:5000/api/billing/status",{headers:{Authorization:`Bearer ${t}`}});W(s.data.plan==="pro"&&s.data.status==="active"||s.data.status==="canceled_active")}catch(t){console.error("Failed to fetch billing status",t)}},_=async()=>{var t,s,o;try{j(!0),v(null);const a=localStorage.getItem("token"),i=await g.get("http://localhost:5000/api/workspaces",{headers:{Authorization:`Bearer ${a}`}});f(i.data.map(l=>{let r=l.state_json||{};try{typeof r=="string"&&(r=JSON.parse(r))}catch(n){console.warn("Failed to parse workspace state:",n),r={}}return{...l,state_json:r}}))}catch(a){console.error("Error fetching workspaces:",a),((t=a.response)==null?void 0:t.status)===401?(localStorage.removeItem("token"),x("/login")):v(((o=(s=a.response)==null?void 0:s.data)==null?void 0:o.msg)||"An unexpected error occurred.")}finally{j(!1)}},O=async(t,s)=>{var o,a,i,l;if(t.stopPropagation(),!N)try{w(s),m.info("Generating PDF Report...");const r=localStorage.getItem("token"),c=(await g.get(`http://localhost:5000/api/workspaces/${s}`,{headers:{Authorization:`Bearer ${r}`}})).data;typeof c.state_json=="string"&&(c.state_json=JSON.parse(c.state_json));const H={name:c.name,description:c.description||((o=c.state_json)==null?void 0:o.description),infraSpec:(a=c.state_json)==null?void 0:a.infraSpec,costEstimation:(i=c.state_json)==null?void 0:i.costEstimation,state_json:c.state_json};J(H,(l=c.state_json)==null?void 0:l.diagramImage),m.success("Report downloaded successfully")}catch(r){console.error("Report generation failed:",r),m.error("Failed to generate report")}finally{w(null)}},z=async(t,s)=>{var i;t.stopPropagation();const a=!(((i=s.state_json)==null?void 0:i.is_live)||!1);try{const l=localStorage.getItem("token"),r={...s.state_json,is_live:a,is_deployed:a};await g.post("http://localhost:5000/api/workspaces/save",{workspaceId:s.id,step:s.step,state:r,name:s.name,projectId:s.project_id},{headers:{Authorization:`Bearer ${l}`}}),f(n=>n.map(c=>c.id===s.id?{...c,state_json:r,updated_at:new Date().toISOString()}:c)),m.success(a?"Project marked as Deployed":"Project marked as Offline")}catch(l){console.error("Failed to toggle status:",l),m.error("Failed to update status")}},S=()=>{x("/workspace/new")},B=async()=>{await F(),x("/")},T=t=>{const s={year:"numeric",month:"short",day:"numeric"};return new Date(t).toLocaleDateString(void 0,s)},k=d.useMemo(()=>p.filter(t=>{var l,r,n;const s=t.name.toLowerCase().includes(u.toLowerCase())||((l=t.description)==null?void 0:l.toLowerCase().includes(u.toLowerCase())),o=t.step==="deployed"||((r=t.state_json)==null?void 0:r.is_deployed)===!0,a=((n=t.state_json)==null?void 0:n.is_live)===!0;let i=!0;return h==="live"?i=o&&a:h==="not_deployed"&&(i=!o),s&&i}),[p,u,h]);return y?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-red-500/5 via-transparent to-transparent",children:e.jsx("div",{className:"max-w-md w-full animate-fade-in",children:e.jsxs("div",{className:"bg-surface/40 backdrop-blur-2xl border border-red-500/20 rounded-3xl p-10 text-center shadow-2xl",children:[e.jsx("h2",{className:"text-3xl font-black text-white mb-4",children:"System Offline"}),e.jsxs("p",{className:"text-gray-400 mb-10",children:['"',y,'"']}),e.jsx("button",{onClick:_,className:"w-full py-4 bg-primary text-black font-black rounded-2xl",children:"RETRY"})]})})}):e.jsx("div",{className:"min-h-screen bg-background p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-text-primary tracking-tight flex items-center gap-3",children:["Welcome, ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-500",children:(b==null?void 0:b.name)||"User"}),E&&e.jsxs("span",{className:"px-3 py-1 bg-gradient-to-r from-yellow-400/20 to-orange-500/20 border border-yellow-400/30 rounded-full text-xs font-bold text-yellow-400 flex items-center gap-1 shadow-[0_0_15px_rgba(250,204,21,0.2)]",children:[e.jsx(V,{className:"w-3.5 h-3.5 fill-yellow-400"})," PRO"]})]}),e.jsx("p",{className:"text-text-secondary mt-2 text-lg",children:"Manage and organize your cloud infrastructure projects"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>x("/"),className:"px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-text-primary font-medium flex items-center gap-2 hover:bg-white/10 transition-colors",children:[e.jsx(q,{className:"w-4 h-4"})," ",e.jsx("span",{children:"Home"})]}),e.jsxs("button",{onClick:()=>x("/settings"),className:"px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-text-primary font-medium flex items-center gap-2 hover:bg-white/10 transition-colors",children:[e.jsx(C,{className:"w-4 h-4"})," ",e.jsx("span",{children:"Settings"})]}),e.jsxs("button",{onClick:B,className:"px-4 py-2 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 font-medium flex items-center gap-2 hover:bg-red-500/20 transition-colors",children:[e.jsx(U,{className:"w-4 h-4"})," ",e.jsx("span",{children:"Logout"})]}),e.jsxs("button",{onClick:S,className:"px-6 py-3 bg-primary text-white rounded-xl font-semibold shadow-lg flex items-center gap-2 hover:shadow-primary/40 transition-all",children:[e.jsx(Y,{className:"w-5 h-5"})," ",e.jsx("span",{children:"New Project"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade-in-up",children:[{label:"Total Projects",value:p.length,icon:P,color:"text-blue-400",bg:"bg-blue-400/10"},{label:"Active Deployments",value:p.filter(t=>{var s,o;return((s=t.state_json)==null?void 0:s.is_deployed)===!0&&((o=t.state_json)==null?void 0:o.is_live)===!0}).length,icon:K,color:"text-green-400",bg:"bg-green-400/10"},{label:"Draft Designs",value:p.filter(t=>{var s;return!((s=t.state_json)!=null&&s.is_deployed)}).length,icon:D,color:"text-purple-400",bg:"bg-purple-400/10"}].map((t,s)=>e.jsx("div",{className:"bg-surface border border-border p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary font-medium mb-1",children:t.label}),e.jsx("p",{className:"text-3xl font-bold text-text-primary",children:t.value})]}),e.jsx("div",{className:`p-4 rounded-xl ${t.bg}`,children:e.jsx(t.icon,{className:`w-8 h-8 ${t.color}`})})]})},s))}),e.jsx("div",{className:"sticky top-4 z-10 bg-background/80 backdrop-blur-xl py-4 -my-4 animate-fade-in-up",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 max-w-4xl",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Q,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search...",value:u,onChange:t=>I(t.target.value),className:"w-full pl-12 pr-4 py-4 bg-surface border border-border rounded-xl text-text-primary focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{className:"relative min-w-[200px]",children:[e.jsxs("select",{value:h,onChange:t=>R(t.target.value),className:"w-full h-full px-4 bg-surface border border-border rounded-xl text-text-primary focus:ring-2 focus:ring-primary/50 appearance-none cursor-pointer",children:[e.jsx("option",{value:"all",children:"All Projects"}),e.jsx("option",{value:"live",children:"Live"}),e.jsx("option",{value:"not_deployed",children:"Not Deployed"})]}),e.jsx(X,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500 pointer-events-none"})]}),e.jsxs("button",{onClick:()=>x("/feedback"),className:"px-4 py-3 bg-surface border border-border rounded-xl text-text-primary hover:border-primary/50 hover:bg-surface/80 transition-all flex items-center gap-2 font-medium",children:[e.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-message-square",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),e.jsx("span",{children:"Feedback"})]})]})}),$?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(L,{className:"w-10 h-10 animate-spin text-primary"})}):k.length===0?e.jsxs("div",{className:"text-center py-20 bg-surface border border-dashed border-border rounded-3xl",children:[e.jsx("h3",{className:"text-xl font-bold text-text-primary",children:"No workspaces found"}),e.jsx("button",{onClick:S,className:"mt-4 px-6 py-2 bg-primary text-white rounded-lg",children:"Create New Project"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 animate-fade-in-up",children:k.map(t=>{var s,o,a,i,l,r;return e.jsx("div",{onClick:()=>x(`/workspace/${t.id}`),className:"group relative bg-surface border border-border rounded-2xl overflow-hidden hover:border-primary/50 transition-all cursor-pointer flex flex-col hover:shadow-xl",children:e.jsxs("div",{className:"p-6 flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:"p-3 bg-background rounded-xl border border-border",children:e.jsx(P,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),x(`/workspace/${t.id}/settings`)},className:"p-1.5 text-text-secondary hover:text-primary hover:bg-surface rounded-lg transition-colors",title:"Workspace Settings",children:e.jsx(C,{className:"w-4 h-4"})}),(t.step==="deployed"||((s=t.state_json)==null?void 0:s.is_deployed)===!0)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2 bg-surface/50 rounded-full px-3 py-1 border border-border/50",onClick:n=>n.stopPropagation(),children:[e.jsx("span",{className:"text-[10px] font-bold tracking-wider text-text-secondary w-12 text-center",children:(o=t.state_json)!=null&&o.is_live?"LIVE":"OFFLINE"}),e.jsx("button",{onClick:n=>z(n,t),className:`w-8 h-4 rounded-full transition-colors relative ${(a=t.state_json)!=null&&a.is_live?"bg-green-500":"bg-gray-600"}`,children:e.jsx("div",{className:`absolute top-0.5 w-3 h-3 bg-white rounded-full transition-transform shadow-sm ${(i=t.state_json)!=null&&i.is_live?"left-4.5":"left-0.5"}`,style:{left:(l=t.state_json)!=null&&l.is_live?"calc(100% - 3.5px - 12px)":"2px"}})})]})})]})]}),e.jsx("h3",{className:"text-xl font-bold text-text-primary mb-2 line-clamp-1",children:t.name}),e.jsx("p",{className:"text-text-secondary text-sm line-clamp-2 mb-6 h-10",children:t.description||"No description"}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-border mt-auto",children:[e.jsxs("div",{className:"flex items-center text-xs text-text-subtle",children:[e.jsx(Z,{className:"w-3.5 h-3.5 mr-1.5"}),e.jsx("span",{children:T(t.updated_at)})]}),(t.step==="deployed"||((r=t.state_json)==null?void 0:r.is_deployed)===!0)&&e.jsxs("button",{onClick:n=>O(n,t.id),className:"flex items-center gap-1 px-3 py-1.5 bg-blue-500/10 text-blue-400 hover:bg-blue-500/20 rounded-lg transition-colors text-xs font-medium",title:"Download PDF Report",children:[N===t.id?e.jsx(L,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(D,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Report"})]})]})]})},t.id)})})]})})};export{oe as default};
