import{u as R,j as e}from"./index-BJnrtPxY.js";import{u as W,r as x}from"./vendor-C8h9W7XM.js";import{a as C,B as A}from"./utils-Bh3U_nHs.js";import{W as I,U as O,S,L as T,P as z,g as j,h as U,i as B,j as G,k as H,l as M}from"./ui-fva4O29X.js";const K=()=>{const{user:g,logout:E}=R(),c=W(),[u,v]=x.useState([]),[L,y]=x.useState(!0),[N,f]=x.useState(null),[p,D]=x.useState(""),[h,$]=x.useState("all");x.useEffect(()=>{b()},[]);const b=async()=>{var t,r,a;try{y(!0),f(null);const o=localStorage.getItem("token"),n=await C.get("http://localhost:5000/api/workspaces",{headers:{Authorization:`Bearer ${o}`}});v(n.data.map(i=>{let s=i.state_json||{};try{typeof s=="string"&&(s=JSON.parse(s))}catch(d){console.warn("Failed to parse workspace state:",d),s={}}return{...i,state_json:s}}))}catch(o){console.error("Error fetching workspaces:",o),((t=o.response)==null?void 0:t.status)===401?(localStorage.removeItem("token"),c("/login")):o.response?f(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.msg)||"An unexpected error occurred while loading workspaces."):f("Server Unreachable. Please ensure the backend is running.")}finally{y(!1)}},w=()=>{c("/workspace/new")},F=async()=>{await E(),c("/")},P=t=>{const r={year:"numeric",month:"short",day:"numeric"};return new Date(t).toLocaleDateString(void 0,r)},_=x.useMemo(()=>u.filter(t=>{var i,s,d;const r=t.name.toLowerCase().includes(p.toLowerCase())||((i=t.description)==null?void 0:i.toLowerCase().includes(p.toLowerCase())),a=t.step==="deployed"||((s=t.state_json)==null?void 0:s.is_deployed)===!0,o=((d=t.state_json)==null?void 0:d.is_live)===!0;let n=!0;return h==="live"?n=a&&o:h==="not_deployed"&&(n=!a),r&&n}),[u,p,h]);return N?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-red-500/5 via-transparent to-transparent",children:e.jsxs("div",{className:"max-w-md w-full animate-fade-in",children:[e.jsxs("div",{className:"bg-surface/40 backdrop-blur-2xl border border-red-500/20 rounded-3xl p-10 text-center shadow-2xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-red-500/50 to-transparent"}),e.jsxs("div",{className:"mb-8 relative inline-block",children:[e.jsx("div",{className:"absolute inset-0 bg-red-500/20 blur-2xl rounded-full scale-150 animate-pulse"}),e.jsx("div",{className:"relative w-20 h-20 bg-red-500/10 rounded-2xl flex items-center justify-center mx-auto border border-red-500/20 rotate-12 group-hover:rotate-0 transition-transform duration-500",children:e.jsx(I,{className:"w-10 h-10 text-red-500"})})]}),e.jsx("h2",{className:"text-3xl font-black text-white mb-4 tracking-tight",children:"System Offline"}),e.jsxs("p",{className:"text-gray-400 mb-10 leading-relaxed text-lg italic font-medium",children:['"',N,'"']}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:b,className:"w-full py-4 bg-primary text-black font-black rounded-2xl transition-all transform hover:scale-[1.03] active:scale-[0.98] shadow-xl shadow-primary/20 flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-black rounded-full animate-ping"}),"TRY RECONNECTING"]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full py-4 bg-white/5 text-gray-400 font-bold rounded-2xl hover:bg-white/10 transition-colors border border-white/5",children:"HARD REFRESH"})]})]}),e.jsxs("p",{className:"text-center mt-8 text-sm text-gray-500 font-medium",children:["Error ID: ",e.jsx("span",{className:"text-primary/50",children:"ECONN_REFUSED_WS"})]})]})}):e.jsx("div",{className:"min-h-screen bg-background p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-extrabold text-text-primary tracking-tight",children:["Welcome, ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-500",children:(g==null?void 0:g.name)||"User"})]}),e.jsx("p",{className:"text-text-secondary mt-2 text-lg",children:"Manage and organize your cloud infrastructure projects"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>c("/profile"),className:"px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-text-primary hover:bg-white/10 transition-colors font-medium flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"Profile"})]}),e.jsxs("button",{onClick:()=>c("/settings"),className:"px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-text-primary hover:bg-white/10 transition-colors font-medium flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Settings"})]}),e.jsxs("button",{onClick:F,className:"px-4 py-2 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 hover:bg-red-500/20 transition-colors font-medium flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Logout"})]}),e.jsxs("button",{onClick:w,className:"group px-6 py-3 bg-primary text-white rounded-xl font-semibold shadow-lg shadow-primary/25 hover:shadow-primary/40 hover:-translate-y-0.5 transition-all duration-300 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 group-hover:rotate-90 transition-transform duration-300"}),e.jsx("span",{children:"New Project"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade-in-up",children:[{label:"Total Projects",value:u.length,icon:j,color:"text-blue-400",bg:"bg-blue-400/10"},{label:"Active Deployments",value:u.filter(t=>{var r,a;return((r=t.state_json)==null?void 0:r.is_deployed)===!0&&((a=t.state_json)==null?void 0:a.is_live)===!0}).length,icon:U,color:"text-green-400",bg:"bg-green-400/10"},{label:"Draft Designs",value:u.filter(t=>{var r;return!((r=t.state_json)!=null&&r.is_deployed)}).length,icon:B,color:"text-purple-400",bg:"bg-purple-400/10"}].map((t,r)=>e.jsx("div",{className:"bg-surface border border-border p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary font-medium mb-1",children:t.label}),e.jsx("p",{className:"text-3xl font-bold text-text-primary",children:t.value})]}),e.jsx("div",{className:`p-4 rounded-xl ${t.bg}`,children:e.jsx(t.icon,{className:`w-8 h-8 ${t.color}`})})]})},r))}),e.jsx("div",{className:"sticky top-4 z-10 bg-background/80 backdrop-blur-xl py-4 -my-4 animate-fade-in-up",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 max-w-4xl",children:[e.jsxs("div",{className:"relative group flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(G,{className:"h-5 w-5 text-text-subtle group-focus-within:text-primary transition-colors duration-300"})}),e.jsx("input",{type:"text",placeholder:"Search workspaces...",className:"block w-full pl-12 pr-4 py-4 bg-surface border border-border rounded-xl text-text-primary placeholder-text-subtle focus:ring-2 focus:ring-primary/50 focus:border-transparent transition-all duration-300 shadow-sm",value:p,onChange:t=>D(t.target.value)})]}),e.jsxs("div",{className:"relative min-w-[200px]",children:[e.jsxs("select",{value:h,onChange:t=>$(t.target.value),className:"w-full h-full px-4 pl-12 bg-surface border border-border rounded-xl text-text-primary focus:ring-2 focus:ring-primary/50 focus:border-transparent transition-all duration-300 outline-none appearance-none cursor-pointer font-medium",children:[e.jsx("option",{value:"all",children:"All Projects"}),e.jsx("option",{value:"live",children:"Live"}),e.jsx("option",{value:"not_deployed",children:"Not Deployed"})]}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-text-subtle",children:e.jsx(H,{className:"w-5 h-5"})}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none text-text-subtle",children:e.jsx("div",{className:"w-0 h-0 border-l-[5px] border-l-transparent border-t-[6px] border-t-current border-r-[5px] border-r-transparent"})})]})]})}),L?e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):_.length===0?e.jsxs("div",{className:"text-center py-20 bg-surface border border-dashed border-border rounded-3xl animate-fade-in",children:[e.jsx("div",{className:"w-20 h-20 bg-surface rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(j,{className:"w-10 h-10 text-text-subtle"})}),e.jsx("h3",{className:"text-xl font-bold text-text-primary mb-2",children:"No workspaces found"}),e.jsx("p",{className:"text-text-secondary max-w-sm mx-auto mb-8",children:p?"Try adjusting your search terms":"Create your first workspace to get started with Cloudiverse"}),e.jsx("button",{onClick:w,className:"px-6 py-3 bg-white/5 border border-white/10 rounded-xl text-text-primary hover:bg-white/10 transition-colors font-medium",children:"Create New Project"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 animate-fade-in-up",children:_.map(t=>{var r,a,o,n,i;return e.jsxs("div",{onClick:()=>c(`/workspace/${t.id}`),className:"group relative bg-surface border border-border rounded-2xl overflow-hidden hover:border-primary/50 transition-all duration-300 hover:shadow-2xl hover:shadow-primary/5 cursor-pointer flex flex-col",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/5 rounded-full blur-3xl -mr-16 -mt-16 group-hover:bg-primary/10 transition-colors duration-500"}),e.jsxs("div",{className:"p-6 flex-1 relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:"p-3 bg-background rounded-xl border border-border shadow-sm group-hover:scale-110 transition-transform duration-300",children:e.jsx(j,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.step==="ready_for_deployment"&&e.jsxs("span",{className:"px-3 py-1 bg-amber-500/10 text-amber-400 text-xs font-bold rounded-full border border-amber-500/20 shadow-sm flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-400 animate-pulse"}),"READY"]}),(t.step==="deployed"||((r=t.state_json)==null?void 0:r.is_deployed)===!0)&&e.jsxs("div",{className:"flex items-center gap-2",title:"Toggle Live Status",children:[e.jsx("button",{onClick:async s=>{var k;s.stopPropagation();const d=!((k=t.state_json)!=null&&k.is_live);v(l=>l.map(m=>m.id===t.id?{...m,step:"deployed",state_json:{...m.state_json,is_live:d,is_deployed:d}}:m));try{const l=localStorage.getItem("token"),m=l?{Authorization:`Bearer ${l}`}:{};await C.put(`http://localhost:5000/api/workspaces/${t.id}/live-status`,{is_live:d},{headers:m}),b()}catch(l){console.error("Failed to toggle live status:",l),l.response&&console.error("Backend error:",l.response.status,l.response.data),A.error("Connection failed. Reverting status."),b()}},className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-surface ${(a=t.state_json)!=null&&a.is_live?"bg-green-500":"bg-gray-600"}`,children:e.jsx("span",{className:`${(o=t.state_json)!=null&&o.is_live?"translate-x-5":"translate-x-1"} inline-block h-3 w-3 transform rounded-full bg-white transition-transform`})}),e.jsx("span",{className:`text-[10px] font-bold tracking-wider ${(n=t.state_json)!=null&&n.is_live?"text-green-400":"text-gray-500"}`,children:(i=t.state_json)!=null&&i.is_live?"LIVE":"OFFLINE"})]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),c(`/workspace/${t.id}/settings`)},className:"p-2 hover:bg-white/5 rounded-lg text-text-subtle hover:text-primary transition-colors",children:e.jsx(S,{className:"w-5 h-5"})})]})]}),e.jsx("h3",{className:"text-xl font-bold text-text-primary mb-2 line-clamp-1 group-hover:text-primary transition-colors",children:t.name}),e.jsx("p",{className:"text-text-secondary text-sm line-clamp-2 mb-6 h-10",children:t.description||"No description provided"}),e.jsx("div",{className:"flex items-center justify-between gap-4 pt-6 border-t border-border mt-auto",children:e.jsxs("div",{className:"flex items-center text-xs text-text-subtle",children:[e.jsx(M,{className:"w-3.5 h-3.5 mr-1.5"}),e.jsx("span",{children:P(t.updated_at)})]})})]})]},t.id)})})]})})};export{K as default};
